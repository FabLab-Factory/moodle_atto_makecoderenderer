YUI.add("moodle-atto_makecoderenderer-button",function(n,e){var i={RESPONSIVE:"img-responsive",INPUTSUBMIT:"atto_makecoderenderer_submit",CLOSE:"atto_makecoderenderer_close",CODESNIPPETAREA:"atto_makecoderenderer_codesnippet_text_area",CODESNIPPETPUB:"atto_makecoderenderer_codesnippet_pub",CODESNIPPET:"atto_makecoderenderer_codesnippet",MAKECODERENDERER:"atto_makecoderenderer_plugin"},s={CODESNIPPETAREA:"#"+i.CODESNIPPETAREA,CODESNIPPETPUB:"#"+i.CODESNIPPETPUB,CODESNIPPET:"."+i.CODESNIPPET,MAKECODERENDERER:"#"+i.MAKECODERENDERER},o="atto_makecoderenderer",r='<pre class="{{CSS.CODESNIPPET}}" data-pub="{{pub}}">{{code}}</pre><p><br></p>';n.namespace("M.atto_makecoderenderer").Button=n.Base.create("button",n.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_attoform:null,initializer:function(){this.addButton({icon:M.util.image_url("ed/makecode","atto_makecoderenderer"),callback:this._displayDialogue,tags:s.CODESNIPPET,tagMatchRequiresAll:!1}),this.editor.delegate("dblclick",this._displayDialogue,s.CODESNIPPET,this),this.editor.delegate("click",this._handleClick,s.CODESNIPPET,this),this.editor.on("dragover",function(e){e.preventDefault()},this),this.editor.on("dragenter",function(e){e.preventDefault()},this)},_handleClick:function(e){var t=e.target,o=this.get("host").getSelectionFromNode(t);this.get("host").getSelection()!==o&&this.get("host").setSelection(o)},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&this.getDialogue({headerContent:M.util.get_string("title",o),width:"auto",focusAfterHide:!0,focusOnShowSelector:s.CODESNIPPET}).set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var e=n.Handlebars.compile('<form class="atto_attoform"><div class="container mt-3"><div class="row"><div class="col-12 form-group"><b><label for="{{CSS.CODESNIPPETPUB}}">{{get_string "help_codesnippet_pub" component}}</label></b><br><label>{{get_string "example_codesnippet_pub" component}}</label><textarea class="form-control" id="{{CSS.CODESNIPPETPUB}}" rows="1"></textarea></div></div><div class="row"><div class="col-12 form-group"><b><label for="{{CSS.CODESNIPPETAREA}}">{{get_string "help_codesnippet" component}}</label></b><br><label>{{get_string "example_codesnippet" component}}</label><textarea class="form-control" id="{{CSS.CODESNIPPETAREA}}" rows="10"></textarea></div></div><div class="row"><div class="col-12 mdl-align"><button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "insert" component}}</button><button class="btn btn-secondary {{CSS.CLOSE}}" type="button">{{get_string "close" component}}</button></div></div></div></form>'),t=n.Node.create(e({elementid:this.get("host").get("elementid"),CSS:i,component:o}));return this._attoform=t,this._setCodesnippet(),this._attoform.one("."+i.INPUTSUBMIT).on("click",this._insertData,this),this._attoform.one("."+i.CLOSE).on("click",this._closeDialogue,this),t},_insertData:function(e){var t="",o="",r=this.get("host");e.preventDefault(),this._updateWarning()||(r.focus(),r.setSelection(this._currentSelection),o=this._getCodeSnippet(),t=n.Handlebars.compile('<div id="{{CSS.MAKECODERENDERER}}"><script>var makeCodeRenderPre = makeCodeRenderPre || (function() {var pendingPres = [];function injectRenderer() {var f = document.getElementById("makecoderenderer");if (f) {    return;}var f = document.createElement("iframe");f.id = "makecoderenderer";f.style.position = "absolute";f.style.left = 0;f.style.bottom = 0;f.style.width = "1px";f.style.height = "1px";f.src = "https://makecode.microbit.org/--docs?render=1";document.body.appendChild(f);}function renderPre(pre) {if (!pre.id) pre.id = Math.random();var f = document.getElementById("makecoderenderer");if (!f || !!pendingPres) {    pendingPres.push(pre);    injectRenderer();} else {    if (pre.getAttribute("data-pub") != "") {        f.contentWindow.postMessage({            type: "renderblocks",            id: pre.id,            code: "",            options: {                packageId: pre.getAttribute("data-pub")            }        }, "https://makecode.microbit.org/");    } else {        f.contentWindow.postMessage({            type: "renderblocks",            id: pre.id,            code: pre.innerText,            options: {}        }, "https://makecode.microbit.org/");    }}}window.addEventListener("message", function(ev) {    var msg = ev.data;    if (msg.source != "makecode") return;    console.log(msg.type);    switch (msg.type) {        case "renderready":            var pres = pendingPres;            pendingPres = undefined;            pres.forEach(function(pre) {                renderPre(pre);            });            break;        case "renderblocks":            var svg = msg.svg;            var id = msg.id;            var img = document.createElement("img");            img.src = msg.uri;            img.width = msg.width;            img.height = msg.height;            var code = document.getElementById(id);            code.parentElement.insertBefore(img, code);            code.parentElement.removeChild(code);            break;    }}, false);return renderPre;})();function renderSnippets() {let pres = document.getElementsByTagName("pre");Array.prototype.forEach.call(pres, function(pre) {    makeCodeRenderPre(pre);})}renderSnippets();<\/script></div>')({CSS:i}),null==this.editor.one(s.MAKECODERENDERER)&&this.editor.append(t),this.get("host").insertContentAtFocusPoint(o),this.markUpdated())},_closeDialogue:function(e){this.getDialogue({focusAfterHide:null}).hide()},_setCodesnippet:function(){var e,t,o,r=this.get("host").getSelectedNodes();(r=r&&r.filter("pre"))&&r.size()&&(e=r.item(0),console.log(e),t=e.get("innerHTML"),(o=e.getAttribute("data-pub"))&&""!=o&&this._attoform.one(s.CODESNIPPETPUB).set("value",o),t&&""!=t&&this._attoform.one(s.CODESNIPPETAREA).set("value",t))},_getCodeSnippet:function(){var e="",t=this._attoform.one(s.CODESNIPPETPUB).get("value"),o=this._attoform.one(
s.CODESNIPPETAREA).get("value");return""!==t&&""!==o?e+=n.Handlebars.compile(r)({pub:t,code:o,CSS:i}):""!==t&&(e+=n.Handlebars.compile(r)({pub:t,code:t,CSS:i})),e},_updateWarning:function(){return!1}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});