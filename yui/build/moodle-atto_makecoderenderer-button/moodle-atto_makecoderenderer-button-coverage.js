
var __cov_kN$7KSxBz037NQUvKiXaeQ = (Function('return this'))();
if (!__cov_kN$7KSxBz037NQUvKiXaeQ.__coverage__) { __cov_kN$7KSxBz037NQUvKiXaeQ.__coverage__ = {}; }
__cov_kN$7KSxBz037NQUvKiXaeQ = __cov_kN$7KSxBz037NQUvKiXaeQ.__coverage__;
if (!(__cov_kN$7KSxBz037NQUvKiXaeQ['build/moodle-atto_makecoderenderer-button/moodle-atto_makecoderenderer-button.js'])) {
   __cov_kN$7KSxBz037NQUvKiXaeQ['build/moodle-atto_makecoderenderer-button/moodle-atto_makecoderenderer-button.js'] = {"path":"build/moodle-atto_makecoderenderer-button/moodle-atto_makecoderenderer-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":47},"end":{"line":1,"column":66}}},"2":{"name":"(anonymous_2)","line":209,"loc":{"start":{"line":209,"column":17},"end":{"line":209,"column":29}}},"3":{"name":"(anonymous_3)","line":221,"loc":{"start":{"line":221,"column":35},"end":{"line":221,"column":48}}},"4":{"name":"(anonymous_4)","line":224,"loc":{"start":{"line":224,"column":36},"end":{"line":224,"column":49}}},"5":{"name":"(anonymous_5)","line":236,"loc":{"start":{"line":236,"column":18},"end":{"line":236,"column":31}}},"6":{"name":"(anonymous_6)","line":251,"loc":{"start":{"line":251,"column":22},"end":{"line":251,"column":34}}},"7":{"name":"(anonymous_7)","line":278,"loc":{"start":{"line":278,"column":25},"end":{"line":278,"column":37}}},"8":{"name":"(anonymous_8)","line":302,"loc":{"start":{"line":302,"column":17},"end":{"line":302,"column":30}}},"9":{"name":"(anonymous_9)","line":339,"loc":{"start":{"line":339,"column":20},"end":{"line":339,"column":32}}},"10":{"name":"(anonymous_10)","line":345,"loc":{"start":{"line":345,"column":21},"end":{"line":345,"column":32}}},"11":{"name":"(anonymous_11)","line":368,"loc":{"start":{"line":368,"column":21},"end":{"line":368,"column":32}}},"12":{"name":"(anonymous_12)","line":400,"loc":{"start":{"line":400,"column":20},"end":{"line":400,"column":32}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":405,"column":61}},"2":{"start":{"line":36,"column":0},"end":{"line":187,"column":17}},"3":{"start":{"line":189,"column":0},"end":{"line":403,"column":3}},"4":{"start":{"line":211,"column":8},"end":{"line":216,"column":11}},"5":{"start":{"line":217,"column":8},"end":{"line":217,"column":93}},"6":{"start":{"line":218,"column":8},"end":{"line":218,"column":86}},"7":{"start":{"line":221,"column":8},"end":{"line":223,"column":17}},"8":{"start":{"line":222,"column":12},"end":{"line":222,"column":31}},"9":{"start":{"line":224,"column":8},"end":{"line":226,"column":17}},"10":{"start":{"line":225,"column":12},"end":{"line":225,"column":31}},"11":{"start":{"line":237,"column":8},"end":{"line":237,"column":35}},"12":{"start":{"line":239,"column":8},"end":{"line":239,"column":75}},"13":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"14":{"start":{"line":241,"column":12},"end":{"line":241,"column":53}},"15":{"start":{"line":253,"column":8},"end":{"line":253,"column":65}},"16":{"start":{"line":254,"column":8},"end":{"line":256,"column":9}},"17":{"start":{"line":255,"column":12},"end":{"line":255,"column":19}},"18":{"start":{"line":258,"column":8},"end":{"line":263,"column":11}},"19":{"start":{"line":266,"column":8},"end":{"line":267,"column":20}},"20":{"start":{"line":279,"column":8},"end":{"line":284,"column":16}},"21":{"start":{"line":286,"column":8},"end":{"line":286,"column":33}},"22":{"start":{"line":288,"column":8},"end":{"line":288,"column":31}},"23":{"start":{"line":289,"column":8},"end":{"line":289,"column":86}},"24":{"start":{"line":290,"column":8},"end":{"line":290,"column":83}},"25":{"start":{"line":292,"column":8},"end":{"line":292,"column":23}},"26":{"start":{"line":303,"column":8},"end":{"line":305,"column":36}},"27":{"start":{"line":307,"column":8},"end":{"line":307,"column":27}},"28":{"start":{"line":310,"column":8},"end":{"line":312,"column":9}},"29":{"start":{"line":311,"column":12},"end":{"line":311,"column":19}},"30":{"start":{"line":315,"column":8},"end":{"line":315,"column":21}},"31":{"start":{"line":316,"column":8},"end":{"line":316,"column":50}},"32":{"start":{"line":318,"column":8},"end":{"line":318,"column":42}},"33":{"start":{"line":320,"column":8},"end":{"line":320,"column":86}},"34":{"start":{"line":321,"column":8},"end":{"line":323,"column":11}},"35":{"start":{"line":325,"column":8},"end":{"line":325,"column":67}},"36":{"start":{"line":326,"column":8},"end":{"line":328,"column":9}},"37":{"start":{"line":327,"column":12},"end":{"line":327,"column":49}},"38":{"start":{"line":330,"column":8},"end":{"line":330,"column":57}},"39":{"start":{"line":331,"column":8},"end":{"line":331,"column":27}},"40":{"start":{"line":340,"column":8},"end":{"line":342,"column":18}},"41":{"start":{"line":347,"column":8},"end":{"line":347,"column":63}},"42":{"start":{"line":348,"column":8},"end":{"line":350,"column":9}},"43":{"start":{"line":349,"column":12},"end":{"line":349,"column":54}},"44":{"start":{"line":352,"column":8},"end":{"line":365,"column":9}},"45":{"start":{"line":353,"column":12},"end":{"line":353,"column":51}},"46":{"start":{"line":354,"column":12},"end":{"line":354,"column":37}},"47":{"start":{"line":356,"column":12},"end":{"line":356,"column":52}},"48":{"start":{"line":357,"column":12},"end":{"line":357,"column":59}},"49":{"start":{"line":359,"column":12},"end":{"line":361,"column":13}},"50":{"start":{"line":360,"column":16},"end":{"line":360,"column":79}},"51":{"start":{"line":362,"column":12},"end":{"line":364,"column":13}},"52":{"start":{"line":363,"column":16},"end":{"line":363,"column":81}},"53":{"start":{"line":369,"column":8},"end":{"line":369,"column":22}},"54":{"start":{"line":370,"column":8},"end":{"line":370,"column":76}},"55":{"start":{"line":371,"column":8},"end":{"line":371,"column":78}},"56":{"start":{"line":373,"column":8},"end":{"line":389,"column":9}},"57":{"start":{"line":374,"column":12},"end":{"line":374,"column":81}},"58":{"start":{"line":375,"column":12},"end":{"line":379,"column":15}},"59":{"start":{"line":380,"column":12},"end":{"line":380,"column":38}},"60":{"start":{"line":381,"column":15},"end":{"line":389,"column":9}},"61":{"start":{"line":382,"column":12},"end":{"line":382,"column":81}},"62":{"start":{"line":383,"column":12},"end":{"line":387,"column":15}},"63":{"start":{"line":388,"column":12},"end":{"line":388,"column":38}},"64":{"start":{"line":390,"column":8},"end":{"line":390,"column":20}},"65":{"start":{"line":401,"column":8},"end":{"line":401,"column":21}}},"branchMap":{"1":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":8},"end":{"line":240,"column":8}},{"start":{"line":240,"column":8},"end":{"line":240,"column":8}}]},"2":{"line":254,"type":"if","locations":[{"start":{"line":254,"column":8},"end":{"line":254,"column":8}},{"start":{"line":254,"column":8},"end":{"line":254,"column":8}}]},"3":{"line":310,"type":"if","locations":[{"start":{"line":310,"column":8},"end":{"line":310,"column":8}},{"start":{"line":310,"column":8},"end":{"line":310,"column":8}}]},"4":{"line":326,"type":"if","locations":[{"start":{"line":326,"column":8},"end":{"line":326,"column":8}},{"start":{"line":326,"column":8},"end":{"line":326,"column":8}}]},"5":{"line":348,"type":"if","locations":[{"start":{"line":348,"column":8},"end":{"line":348,"column":8}},{"start":{"line":348,"column":8},"end":{"line":348,"column":8}}]},"6":{"line":352,"type":"if","locations":[{"start":{"line":352,"column":8},"end":{"line":352,"column":8}},{"start":{"line":352,"column":8},"end":{"line":352,"column":8}}]},"7":{"line":352,"type":"binary-expr","locations":[{"start":{"line":352,"column":12},"end":{"line":352,"column":24}},{"start":{"line":352,"column":28},"end":{"line":352,"column":47}}]},"8":{"line":359,"type":"if","locations":[{"start":{"line":359,"column":12},"end":{"line":359,"column":12}},{"start":{"line":359,"column":12},"end":{"line":359,"column":12}}]},"9":{"line":359,"type":"binary-expr","locations":[{"start":{"line":359,"column":15},"end":{"line":359,"column":18}},{"start":{"line":359,"column":22},"end":{"line":359,"column":29}}]},"10":{"line":362,"type":"if","locations":[{"start":{"line":362,"column":12},"end":{"line":362,"column":12}},{"start":{"line":362,"column":12},"end":{"line":362,"column":12}}]},"11":{"line":362,"type":"binary-expr","locations":[{"start":{"line":362,"column":15},"end":{"line":362,"column":19}},{"start":{"line":362,"column":23},"end":{"line":362,"column":31}}]},"12":{"line":373,"type":"if","locations":[{"start":{"line":373,"column":8},"end":{"line":373,"column":8}},{"start":{"line":373,"column":8},"end":{"line":373,"column":8}}]},"13":{"line":373,"type":"binary-expr","locations":[{"start":{"line":373,"column":11},"end":{"line":373,"column":21}},{"start":{"line":373,"column":25},"end":{"line":373,"column":36}}]},"14":{"line":381,"type":"if","locations":[{"start":{"line":381,"column":15},"end":{"line":381,"column":15}},{"start":{"line":381,"column":15},"end":{"line":381,"column":15}}]}},"code":["(function () { YUI.add('moodle-atto_makecoderenderer-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/*"," * @package    atto_makecoderenderer"," * @copyright  2020 Zimcke Van de Staey <zimcke@fablabfactory.com>"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_makecoderenderer-button"," */","","/**"," * Atto makecoderenderer plugin."," *"," * @namespace M.atto_makecoderenderer"," * @class button"," * @extends M.editor_atto.EditorPlugin"," */","","var CSS = {","        RESPONSIVE: 'img-responsive',","        INPUTSUBMIT: 'atto_makecoderenderer_submit',","        CLOSE: 'atto_makecoderenderer_close',","        CODESNIPPETAREA: 'atto_makecoderenderer_codesnippet_text_area',","        CODESNIPPETPUB: 'atto_makecoderenderer_codesnippet_pub',","        CODESNIPPET: 'atto_makecoderenderer_codesnippet',","        MAKECODERENDERER: 'atto_makecoderenderer_plugin'","    },","","    SELECTORS = {","        CODESNIPPETAREA: '#' + CSS.CODESNIPPETAREA,","        CODESNIPPETPUB: '#' + CSS.CODESNIPPETPUB,","        CODESNIPPET: '.' + CSS.CODESNIPPET,","        MAKECODERENDERER: '#' + CSS.MAKECODERENDERER","    },","","    COMPONENTNAME = 'atto_makecoderenderer',","  ","    /**","     * The form template for the MakeCode codesnippet dialogue","     */","    TEMPLATE = '' +","        '<form class=\"atto_attoform\">' +","        '<div class=\"container mt-3\">' +","","        '<div class=\"row\">' +","        '<div class=\"col-12 form-group\">' +","        '<b><label for=\"{{CSS.CODESNIPPETPUB}}\">{{get_string \"help_codesnippet_pub\" component}}</label></b><br>' +","        '<label>{{get_string \"example_codesnippet_pub\" component}}</label>' +","        '<textarea class=\"form-control\" id=\"{{CSS.CODESNIPPETPUB}}\" rows=\"1\"></textarea>' +","        '</div>' +","        '</div>' +","","        '<div class=\"row\">' +","        '<div class=\"col-12 form-group\">' +","        '<b><label for=\"{{CSS.CODESNIPPETAREA}}\">{{get_string \"help_codesnippet\" component}}</label></b><br>' +","        '<label>{{get_string \"example_codesnippet\" component}}</label>' +","        '<textarea class=\"form-control\" id=\"{{CSS.CODESNIPPETAREA}}\" rows=\"10\"></textarea>' +","        '</div>' +","        '</div>' +","","        '<div class=\"row\">' +","        '<div class=\"col-12 mdl-align\">' +","        '<button class=\"btn btn-secondary {{CSS.INPUTSUBMIT}}\" type=\"submit\">' + '' +","        '{{get_string \"insert\" component}}</button>' +","","        '<button class=\"btn btn-secondary {{CSS.CLOSE}}\" type=\"button\">' + '' +","        '{{get_string \"close\" component}}</button>' +","        '</div>' +","        '</div>' +","","        '</div>' +","        '</form>',","","    /**","     * All templates for content generation","     */","    CODESNIPPETTEMPLATE = '' +","        '<pre class=\"{{CSS.CODESNIPPET}}\" data-pub=\"{{pub}}\">'+","        '{{code}}' +","        '</pre><p><br></p>',","","    MAKECODERENDERERTEMPLATE = '' +","        '<div id=\"{{CSS.MAKECODERENDERER}}\">' +","        '<script>'+","        'var makeCodeRenderPre = makeCodeRenderPre || (function() {' +","            'var pendingPres = [];' +","","            'function injectRenderer() {' +","                'var f = document.getElementById(\"makecoderenderer\");' +","                'if (f) {' +","                '    return;' +","                '}' +","                'var f = document.createElement(\"iframe\");' +","                'f.id = \"makecoderenderer\";' +","                'f.style.position = \"absolute\";' +","                'f.style.left = 0;' +","                'f.style.bottom = 0;' +","                'f.style.width = \"1px\";' +","                'f.style.height = \"1px\";'+","                'f.src = \"https://makecode.microbit.org/--docs?render=1\";' +","                'document.body.appendChild(f);' +","            '}' +","","            'function renderPre(pre) {' +","                'if (!pre.id) pre.id = Math.random();' +","                'var f = document.getElementById(\"makecoderenderer\");' +","                'if (!f || !!pendingPres) {' +","                '    pendingPres.push(pre);' +","                '    injectRenderer();' +","                '} else {' +","                '    if (pre.getAttribute(\"data-pub\") != \"\") {' +","                '        f.contentWindow.postMessage({' +","                '            type: \"renderblocks\",' +","                '            id: pre.id,' +","                '            code: \"\",' +","                '            options: {' +","                '                packageId: pre.getAttribute(\"data-pub\")' +","                '            }' +","                '        }, \"https://makecode.microbit.org/\");' +","                '    } else {' +","                '        f.contentWindow.postMessage({' +","                '            type: \"renderblocks\",' + ","                '            id: pre.id,' +","                '            code: pre.innerText,' +","                '            options: {}' +","                '        }, \"https://makecode.microbit.org/\");' +","                '    }' +","                '}' +","            '}' +","","            'window.addEventListener(\"message\", function(ev) {' +","            '    var msg = ev.data;' +","            '    if (msg.source != \"makecode\") return;' +","","            '    console.log(msg.type);' +","            '    switch (msg.type) {' +","            '        case \"renderready\":' +        \t\t\t\t","            '            var pres = pendingPres;' +","            '            pendingPres = undefined;' +","            '            pres.forEach(function(pre) {' +","            '                renderPre(pre);' +","            '            });' +","            '            break;' +","            '        case \"renderblocks\":' +","            '            var svg = msg.svg;' +","            '            var id = msg.id;' +","            '            var img = document.createElement(\"img\");' +","            '            img.src = msg.uri;' +","            '            img.width = msg.width;' +","            '            img.height = msg.height;' +","            '            var code = document.getElementById(id);' +","            '            code.parentElement.insertBefore(img, code);' +","            '            code.parentElement.removeChild(code);' +","            '            break;' +","            '    }' +","            '}, false);' +","","            'return renderPre;' +","        '})();' +","","        'function renderSnippets() {' +","            'let pres = document.getElementsByTagName(\"pre\");' +","            'Array.prototype.forEach.call(pres, function(pre) {' +","            '    makeCodeRenderPre(pre);' +","            '})' +","        '}' +","","        'renderSnippets();' +","        '</script>' +","        '</div>';","","Y.namespace('M.atto_makecoderenderer').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","    /**","    * A reference to the current selection at the time that the dialogue","    * was opened.","    *","    * @property _currentSelection","    * @type Range","    * @private","    */","    _currentSelection: null,","","    /**","    * A reference to the currently open form.","    *","    * @param _attoform","    * @type Node","    * @private","    */","    _attoform: null,","","    initializer: function () {","","        this.addButton({","            icon: M.util.image_url(\"ed/\" + 'makecode', \"atto_makecoderenderer\"),","            callback: this._displayDialogue,","            tags: SELECTORS.CODESNIPPET, ","            tagMatchRequiresAll: false","        });","        this.editor.delegate('dblclick', this._displayDialogue, SELECTORS.CODESNIPPET, this); ","        this.editor.delegate('click', this._handleClick, SELECTORS.CODESNIPPET, this);","","        // e.preventDefault needed to stop the default event from clobbering the desired behaviour in some browsers.","        this.editor.on('dragover', function (e) {","            e.preventDefault();","        }, this);","        this.editor.on('dragenter', function (e) {","            e.preventDefault();","        }, this);","    },","","    /**","    * Handle a click on a codesnippet.","    *","    * @method _handleClick","    * @param {EventFacade} e","    * @private","    */","    _handleClick: function (e) {","        var codesnippet = e.target;","","        var selection = this.get('host').getSelectionFromNode(codesnippet);","        if (this.get('host').getSelection() !== selection) {","            this.get('host').setSelection(selection);","        }","    },","","    /**","    * Display the codesnippet editing tool.","    *","    * @method _displayDialogue","    * @private","    */","    _displayDialogue: function () {","        // Store the current selection.","        this._currentSelection = this.get('host').getSelection();","        if (this._currentSelection === false) {","            return;","        }","","        var dialogue = this.getDialogue({","            headerContent: M.util.get_string('title', COMPONENTNAME),","            width: 'auto',","            focusAfterHide: true,","            focusOnShowSelector: SELECTORS.CODESNIPPET","        });","","        // Set the dialogue content, and then show the dialogue.","        dialogue.set('bodyContent', this._getDialogueContent())","            .show();","    },","","    /**","    * Return the dialogue content for the tool, attaching any required","    * events.","    *","    * @method _getDialogueContent","    * @return {Node} The content to place in the dialogue.","    * @private","    */","    _getDialogueContent: function () {","        var template = Y.Handlebars.compile(TEMPLATE),","            content = Y.Node.create(template({","                elementid: this.get('host').get('elementid'),","                CSS: CSS,","                component: COMPONENTNAME","            }));","","        this._attoform = content;","","        this._setCodesnippet();","        this._attoform.one('.' + CSS.INPUTSUBMIT).on('click', this._insertData, this);","        this._attoform.one('.' + CSS.CLOSE).on('click', this._closeDialogue, this);","","        return content;","    },","  ","","    /**","     * Parse and insert the data of the dialogue form into the editor at the suitable location (as a child of fablib_contentwrapper)","     * ","     * @param {Event} e ","     * @private","     */","    _insertData: function (e) {","        var makecoderenderer = '',","            html = '',","            host = this.get('host');","","        e.preventDefault();","","        // Check if there are any accessibility issues.","        if (this._updateWarning()) {","            return;","        }","","        // Focus on the editor in preparation for inserting the image.","        host.focus();","        host.setSelection(this._currentSelection);","","        var html = this._getCodeSnippet();","","        var makecoderenderertemplate = Y.Handlebars.compile(MAKECODERENDERERTEMPLATE);","        makecoderenderer = makecoderenderertemplate({","            CSS: CSS","        });","","        var renderer = this.editor.one(SELECTORS.MAKECODERENDERER);","        if(renderer == null){","            this.editor.append(makecoderenderer);","        }","","        this.get('host').insertContentAtFocusPoint(html);","        this.markUpdated();","    },","","    /**","     * Close the dialogue ","     * ","     * @param {Event} e ","     */","    _closeDialogue: function(e) {","        this.getDialogue({","            focusAfterHide: null","        }).hide();","    },","","    _setCodesnippet: function() {","","        var codesnippets = this.get('host').getSelectedNodes();","        if (codesnippets) {","            codesnippets = codesnippets.filter('pre');","        }","","        if (codesnippets && codesnippets.size()) {","            var codesnippet = codesnippets.item(0);","            console.log(codesnippet);","","            var code = codesnippet.get('innerHTML');","            var pub = codesnippet.getAttribute('data-pub');","        ","            if(pub && pub!=''){","                this._attoform.one(SELECTORS.CODESNIPPETPUB).set('value', pub);","            }","            if(code && code!=''){","                this._attoform.one(SELECTORS.CODESNIPPETAREA).set('value', code);","            }","        }","    },","","    _getCodeSnippet: function() {","        var html = '';","        var pub = this._attoform.one(SELECTORS.CODESNIPPETPUB).get('value');","        var code = this._attoform.one(SELECTORS.CODESNIPPETAREA).get('value');","","        if(pub !== '' && code !== ''){","            var codesnippettemplate = Y. Handlebars.compile(CODESNIPPETTEMPLATE);","            var codesnippet = codesnippettemplate({","                pub: pub,","                code: code,","                CSS: CSS","            });","            html = html + codesnippet;   ","        } else if(pub !== ''){","            var codesnippettemplate = Y. Handlebars.compile(CODESNIPPETTEMPLATE);","            var codesnippet = codesnippettemplate({","                pub: pub,","                code: pub,","                CSS: CSS","            });","            html = html + codesnippet;   ","        }","        return html;","    },","","    /**","    * Update the alt text warning live.","    *","    * @method _updateWarning","    * @return {boolean} whether a warning should be displayed.","    * @private","    */","    _updateWarning: function () {","        return false;","    }","});","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
__cov_kN$7KSxBz037NQUvKiXaeQ = __cov_kN$7KSxBz037NQUvKiXaeQ['build/moodle-atto_makecoderenderer-button/moodle-atto_makecoderenderer-button.js'];
__cov_kN$7KSxBz037NQUvKiXaeQ.s['1']++;YUI.add('moodle-atto_makecoderenderer-button',function(Y,NAME){__cov_kN$7KSxBz037NQUvKiXaeQ.f['1']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['2']++;var CSS={RESPONSIVE:'img-responsive',INPUTSUBMIT:'atto_makecoderenderer_submit',CLOSE:'atto_makecoderenderer_close',CODESNIPPETAREA:'atto_makecoderenderer_codesnippet_text_area',CODESNIPPETPUB:'atto_makecoderenderer_codesnippet_pub',CODESNIPPET:'atto_makecoderenderer_codesnippet',MAKECODERENDERER:'atto_makecoderenderer_plugin'},SELECTORS={CODESNIPPETAREA:'#'+CSS.CODESNIPPETAREA,CODESNIPPETPUB:'#'+CSS.CODESNIPPETPUB,CODESNIPPET:'.'+CSS.CODESNIPPET,MAKECODERENDERER:'#'+CSS.MAKECODERENDERER},COMPONENTNAME='atto_makecoderenderer',TEMPLATE=''+'<form class="atto_attoform">'+'<div class="container mt-3">'+'<div class="row">'+'<div class="col-12 form-group">'+'<b><label for="{{CSS.CODESNIPPETPUB}}">{{get_string "help_codesnippet_pub" component}}</label></b><br>'+'<label>{{get_string "example_codesnippet_pub" component}}</label>'+'<textarea class="form-control" id="{{CSS.CODESNIPPETPUB}}" rows="1"></textarea>'+'</div>'+'</div>'+'<div class="row">'+'<div class="col-12 form-group">'+'<b><label for="{{CSS.CODESNIPPETAREA}}">{{get_string "help_codesnippet" component}}</label></b><br>'+'<label>{{get_string "example_codesnippet" component}}</label>'+'<textarea class="form-control" id="{{CSS.CODESNIPPETAREA}}" rows="10"></textarea>'+'</div>'+'</div>'+'<div class="row">'+'<div class="col-12 mdl-align">'+'<button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">'+''+'{{get_string "insert" component}}</button>'+'<button class="btn btn-secondary {{CSS.CLOSE}}" type="button">'+''+'{{get_string "close" component}}</button>'+'</div>'+'</div>'+'</div>'+'</form>',CODESNIPPETTEMPLATE=''+'<pre class="{{CSS.CODESNIPPET}}" data-pub="{{pub}}">'+'{{code}}'+'</pre><p><br></p>',MAKECODERENDERERTEMPLATE=''+'<div id="{{CSS.MAKECODERENDERER}}">'+'<script>'+'var makeCodeRenderPre = makeCodeRenderPre || (function() {'+'var pendingPres = [];'+'function injectRenderer() {'+'var f = document.getElementById("makecoderenderer");'+'if (f) {'+'    return;'+'}'+'var f = document.createElement("iframe");'+'f.id = "makecoderenderer";'+'f.style.position = "absolute";'+'f.style.left = 0;'+'f.style.bottom = 0;'+'f.style.width = "1px";'+'f.style.height = "1px";'+'f.src = "https://makecode.microbit.org/--docs?render=1";'+'document.body.appendChild(f);'+'}'+'function renderPre(pre) {'+'if (!pre.id) pre.id = Math.random();'+'var f = document.getElementById("makecoderenderer");'+'if (!f || !!pendingPres) {'+'    pendingPres.push(pre);'+'    injectRenderer();'+'} else {'+'    if (pre.getAttribute("data-pub") != "") {'+'        f.contentWindow.postMessage({'+'            type: "renderblocks",'+'            id: pre.id,'+'            code: "",'+'            options: {'+'                packageId: pre.getAttribute("data-pub")'+'            }'+'        }, "https://makecode.microbit.org/");'+'    } else {'+'        f.contentWindow.postMessage({'+'            type: "renderblocks",'+'            id: pre.id,'+'            code: pre.innerText,'+'            options: {}'+'        }, "https://makecode.microbit.org/");'+'    }'+'}'+'}'+'window.addEventListener("message", function(ev) {'+'    var msg = ev.data;'+'    if (msg.source != "makecode") return;'+'    console.log(msg.type);'+'    switch (msg.type) {'+'        case "renderready":'+'            var pres = pendingPres;'+'            pendingPres = undefined;'+'            pres.forEach(function(pre) {'+'                renderPre(pre);'+'            });'+'            break;'+'        case "renderblocks":'+'            var svg = msg.svg;'+'            var id = msg.id;'+'            var img = document.createElement("img");'+'            img.src = msg.uri;'+'            img.width = msg.width;'+'            img.height = msg.height;'+'            var code = document.getElementById(id);'+'            code.parentElement.insertBefore(img, code);'+'            code.parentElement.removeChild(code);'+'            break;'+'    }'+'}, false);'+'return renderPre;'+'})();'+'function renderSnippets() {'+'let pres = document.getElementsByTagName("pre");'+'Array.prototype.forEach.call(pres, function(pre) {'+'    makeCodeRenderPre(pre);'+'})'+'}'+'renderSnippets();'+'</script>'+'</div>';__cov_kN$7KSxBz037NQUvKiXaeQ.s['3']++;Y.namespace('M.atto_makecoderenderer').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_attoform:null,initializer:function(){__cov_kN$7KSxBz037NQUvKiXaeQ.f['2']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['4']++;this.addButton({icon:M.util.image_url('ed/'+'makecode','atto_makecoderenderer'),callback:this._displayDialogue,tags:SELECTORS.CODESNIPPET,tagMatchRequiresAll:false});__cov_kN$7KSxBz037NQUvKiXaeQ.s['5']++;this.editor.delegate('dblclick',this._displayDialogue,SELECTORS.CODESNIPPET,this);__cov_kN$7KSxBz037NQUvKiXaeQ.s['6']++;this.editor.delegate('click',this._handleClick,SELECTORS.CODESNIPPET,this);__cov_kN$7KSxBz037NQUvKiXaeQ.s['7']++;this.editor.on('dragover',function(e){__cov_kN$7KSxBz037NQUvKiXaeQ.f['3']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['8']++;e.preventDefault();},this);__cov_kN$7KSxBz037NQUvKiXaeQ.s['9']++;this.editor.on('dragenter',function(e){__cov_kN$7KSxBz037NQUvKiXaeQ.f['4']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['10']++;e.preventDefault();},this);},_handleClick:function(e){__cov_kN$7KSxBz037NQUvKiXaeQ.f['5']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['11']++;var codesnippet=e.target;__cov_kN$7KSxBz037NQUvKiXaeQ.s['12']++;var selection=this.get('host').getSelectionFromNode(codesnippet);__cov_kN$7KSxBz037NQUvKiXaeQ.s['13']++;if(this.get('host').getSelection()!==selection){__cov_kN$7KSxBz037NQUvKiXaeQ.b['1'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['14']++;this.get('host').setSelection(selection);}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['1'][1]++;}},_displayDialogue:function(){__cov_kN$7KSxBz037NQUvKiXaeQ.f['6']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['15']++;this._currentSelection=this.get('host').getSelection();__cov_kN$7KSxBz037NQUvKiXaeQ.s['16']++;if(this._currentSelection===false){__cov_kN$7KSxBz037NQUvKiXaeQ.b['2'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['17']++;return;}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['2'][1]++;}__cov_kN$7KSxBz037NQUvKiXaeQ.s['18']++;var dialogue=this.getDialogue({headerContent:M.util.get_string('title',COMPONENTNAME),width:'auto',focusAfterHide:true,focusOnShowSelector:SELECTORS.CODESNIPPET});__cov_kN$7KSxBz037NQUvKiXaeQ.s['19']++;dialogue.set('bodyContent',this._getDialogueContent()).show();},_getDialogueContent:function(){__cov_kN$7KSxBz037NQUvKiXaeQ.f['7']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['20']++;var template=Y.Handlebars.compile(TEMPLATE),content=Y.Node.create(template({elementid:this.get('host').get('elementid'),CSS:CSS,component:COMPONENTNAME}));__cov_kN$7KSxBz037NQUvKiXaeQ.s['21']++;this._attoform=content;__cov_kN$7KSxBz037NQUvKiXaeQ.s['22']++;this._setCodesnippet();__cov_kN$7KSxBz037NQUvKiXaeQ.s['23']++;this._attoform.one('.'+CSS.INPUTSUBMIT).on('click',this._insertData,this);__cov_kN$7KSxBz037NQUvKiXaeQ.s['24']++;this._attoform.one('.'+CSS.CLOSE).on('click',this._closeDialogue,this);__cov_kN$7KSxBz037NQUvKiXaeQ.s['25']++;return content;},_insertData:function(e){__cov_kN$7KSxBz037NQUvKiXaeQ.f['8']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['26']++;var makecoderenderer='',html='',host=this.get('host');__cov_kN$7KSxBz037NQUvKiXaeQ.s['27']++;e.preventDefault();__cov_kN$7KSxBz037NQUvKiXaeQ.s['28']++;if(this._updateWarning()){__cov_kN$7KSxBz037NQUvKiXaeQ.b['3'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['29']++;return;}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['3'][1]++;}__cov_kN$7KSxBz037NQUvKiXaeQ.s['30']++;host.focus();__cov_kN$7KSxBz037NQUvKiXaeQ.s['31']++;host.setSelection(this._currentSelection);__cov_kN$7KSxBz037NQUvKiXaeQ.s['32']++;var html=this._getCodeSnippet();__cov_kN$7KSxBz037NQUvKiXaeQ.s['33']++;var makecoderenderertemplate=Y.Handlebars.compile(MAKECODERENDERERTEMPLATE);__cov_kN$7KSxBz037NQUvKiXaeQ.s['34']++;makecoderenderer=makecoderenderertemplate({CSS:CSS});__cov_kN$7KSxBz037NQUvKiXaeQ.s['35']++;var renderer=this.editor.one(SELECTORS.MAKECODERENDERER);__cov_kN$7KSxBz037NQUvKiXaeQ.s['36']++;if(renderer==null){__cov_kN$7KSxBz037NQUvKiXaeQ.b['4'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['37']++;this.editor.append(makecoderenderer);}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['4'][1]++;}__cov_kN$7KSxBz037NQUvKiXaeQ.s['38']++;this.get('host').insertContentAtFocusPoint(html);__cov_kN$7KSxBz037NQUvKiXaeQ.s['39']++;this.markUpdated();},_closeDialogue:function(e){__cov_kN$7KSxBz037NQUvKiXaeQ.f['9']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['40']++;this.getDialogue({focusAfterHide:null}).hide();},_setCodesnippet:function(){__cov_kN$7KSxBz037NQUvKiXaeQ.f['10']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['41']++;var codesnippets=this.get('host').getSelectedNodes();__cov_kN$7KSxBz037NQUvKiXaeQ.s['42']++;if(codesnippets){__cov_kN$7KSxBz037NQUvKiXaeQ.b['5'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['43']++;codesnippets=codesnippets.filter('pre');}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['5'][1]++;}__cov_kN$7KSxBz037NQUvKiXaeQ.s['44']++;if((__cov_kN$7KSxBz037NQUvKiXaeQ.b['7'][0]++,codesnippets)&&(__cov_kN$7KSxBz037NQUvKiXaeQ.b['7'][1]++,codesnippets.size())){__cov_kN$7KSxBz037NQUvKiXaeQ.b['6'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['45']++;var codesnippet=codesnippets.item(0);__cov_kN$7KSxBz037NQUvKiXaeQ.s['46']++;console.log(codesnippet);__cov_kN$7KSxBz037NQUvKiXaeQ.s['47']++;var code=codesnippet.get('innerHTML');__cov_kN$7KSxBz037NQUvKiXaeQ.s['48']++;var pub=codesnippet.getAttribute('data-pub');__cov_kN$7KSxBz037NQUvKiXaeQ.s['49']++;if((__cov_kN$7KSxBz037NQUvKiXaeQ.b['9'][0]++,pub)&&(__cov_kN$7KSxBz037NQUvKiXaeQ.b['9'][1]++,pub!='')){__cov_kN$7KSxBz037NQUvKiXaeQ.b['8'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['50']++;this._attoform.one(SELECTORS.CODESNIPPETPUB).set('value',pub);}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['8'][1]++;}__cov_kN$7KSxBz037NQUvKiXaeQ.s['51']++;if((__cov_kN$7KSxBz037NQUvKiXaeQ.b['11'][0]++,code)&&(__cov_kN$7KSxBz037NQUvKiXaeQ.b['11'][1]++,code!='')){__cov_kN$7KSxBz037NQUvKiXaeQ.b['10'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['52']++;this._attoform.one(SELECTORS.CODESNIPPETAREA).set('value',code);}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['10'][1]++;}}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['6'][1]++;}},_getCodeSnippet:function(){__cov_kN$7KSxBz037NQUvKiXaeQ.f['11']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['53']++;var html='';__cov_kN$7KSxBz037NQUvKiXaeQ.s['54']++;var pub=this._attoform.one(SELECTORS.CODESNIPPETPUB).get('value');__cov_kN$7KSxBz037NQUvKiXaeQ.s['55']++;var code=this._attoform.one(SELECTORS.CODESNIPPETAREA).get('value');__cov_kN$7KSxBz037NQUvKiXaeQ.s['56']++;if((__cov_kN$7KSxBz037NQUvKiXaeQ.b['13'][0]++,pub!=='')&&(__cov_kN$7KSxBz037NQUvKiXaeQ.b['13'][1]++,code!=='')){__cov_kN$7KSxBz037NQUvKiXaeQ.b['12'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['57']++;var codesnippettemplate=Y.Handlebars.compile(CODESNIPPETTEMPLATE);__cov_kN$7KSxBz037NQUvKiXaeQ.s['58']++;var codesnippet=codesnippettemplate({pub:pub,code:code,CSS:CSS});__cov_kN$7KSxBz037NQUvKiXaeQ.s['59']++;html=html+codesnippet;}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['12'][1]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['60']++;if(pub!==''){__cov_kN$7KSxBz037NQUvKiXaeQ.b['14'][0]++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['61']++;var codesnippettemplate=Y.Handlebars.compile(CODESNIPPETTEMPLATE);__cov_kN$7KSxBz037NQUvKiXaeQ.s['62']++;var codesnippet=codesnippettemplate({pub:pub,code:pub,CSS:CSS});__cov_kN$7KSxBz037NQUvKiXaeQ.s['63']++;html=html+codesnippet;}else{__cov_kN$7KSxBz037NQUvKiXaeQ.b['14'][1]++;}}__cov_kN$7KSxBz037NQUvKiXaeQ.s['64']++;return html;},_updateWarning:function(){__cov_kN$7KSxBz037NQUvKiXaeQ.f['12']++;__cov_kN$7KSxBz037NQUvKiXaeQ.s['65']++;return false;}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});
